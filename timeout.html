<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Timeout</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding-top: 80px; background:#f9f9f9; }
    .card {
      display: inline-block;
      padding: 30px 50px;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      max-width: 420px;
    }
    h2 { margin-bottom: 20px; font-size: 1.8em; }
    #countdown { margin: 20px 0; font-size: 1.2em; font-weight: bold; }
    #retryBtn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background: #ccc;
      color: #fff;
      cursor: not-allowed;
      font-size: 1em;
    }
    #retryBtn.enabled { background: #28a745; cursor: pointer; }
    #retryBtn.enabled:hover { background: #218838; }

    /* Glow styles */
    .session { border:2px solid #ff9800; animation: glowSession 2s ease-in-out infinite alternate; }
    .ipban   { border:2px solid #cc0000; animation: glowIp 2s ease-in-out infinite alternate; }

    @keyframes glowSession {
      from { box-shadow: 0 0 10px rgba(255,152,0,0.4); }
      to   { box-shadow: 0 0 25px rgba(255,152,0,0.7); }
    }
    @keyframes glowIp {
      from { box-shadow: 0 0 10px rgba(204,0,0,0.4); }
      to   { box-shadow: 0 0 25px rgba(204,0,0,0.7); }
    }
  </style>
</head>
<body>
  <div class="card" id="cardBox">
    <h2 id="title">Timeout</h2>
    <p id="reason"></p>
    <div id="countdown"></div>
    <button id="retryBtn" disabled>Back to Login</button>
  </div>

  <script>
    // Read type from query string
    const params = new URLSearchParams(window.location.search);
    const type = params.get("type");

    const cardBox = document.getElementById("cardBox");
    const titleEl = document.getElementById("title");
    const reasonEl = document.getElementById("reason");
    const countdownEl = document.getElementById("countdown");
    const retryBtn = document.getElementById("retryBtn");

    let timeLeft;

    if (type === "ip") {
      cardBox.classList.add("ipban");
      titleEl.textContent = "Access Blocked";
      reasonEl.textContent = "Your IP has been blocked due to too many failed attempts.";
      timeLeft = 14 * 24 * 60 * 60; // 2 weeks
    } else {
      cardBox.classList.add("session");
      titleEl.textContent = "Temporary Timeout";
      reasonEl.textContent = "Too many wrong passkeys in this session.";
      timeLeft = 180; // 3 minutes
    }

    const timer = setInterval(() => {
      timeLeft--;
      if (type === "ip") {
        const days = Math.floor(timeLeft / (24*60*60));
        const hours = Math.floor((timeLeft % (24*60*60)) / 3600);
        const minutes = Math.floor((timeLeft % 3600) / 60);
        const seconds = timeLeft % 60;
        countdownEl.textContent = `Please wait ${days}d ${hours}h ${minutes}m ${seconds}s before retrying.`;
      } else {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        countdownEl.textContent = `Please wait ${minutes}:${seconds.toString().padStart(2,'0')} minutes...`;
      }

      if (timeLeft <= 0) {
        clearInterval(timer);
        countdownEl.textContent = "You may now retry.";
        retryBtn.disabled = false;
        retryBtn.classList.add("enabled");
        retryBtn.textContent = "Back to Login";
        retryBtn.onclick = () => window.location.href = "index.html";
      }
    }, 1000);
  </script>
</body>
</html>
